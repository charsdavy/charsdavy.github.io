<!DOCTYPE html>
<html>
<head>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-1696534394699613",
      enable_page_level_ads: true
    });
  </script>
  
  <meta charset="utf-8">
  
  <title>Xcode插件开发教程指南 - Chars&#39;s Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="摘要：对于Xcode而言，我们苹果开发者并不陌生，对于Xcode的插件，我们也不陌生。但是，有几个人做过Xcode插件呢？！Who care？显然，博主是关心的，这里分享一下博主自己开发插件的过程。">
<meta property="og:type" content="article">
<meta property="og:title" content="Xcode插件开发教程指南">
<meta property="og:url" content="http://charsdavy.github.io/2016/03/25/xcode-plugin-develop/index.html">
<meta property="og:site_name" content="Chars's Tech Blog">
<meta property="og:description" content="摘要：对于Xcode而言，我们苹果开发者并不陌生，对于Xcode的插件，我们也不陌生。但是，有几个人做过Xcode插件呢？！Who care？显然，博主是关心的，这里分享一下博主自己开发插件的过程。">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-8badd5c1eaccb38b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-fd793ba30c7f7fca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-44a2d20adddc97ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-2dd7603d97b0b42f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-9c41ca195b3ba670.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-12e203138789f666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-255646a7f96b5d6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-f71208a60c0568c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-c5cd468f1b7f4332.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1492739-1a1146bc89c01d63.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2016-08-03T12:21:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xcode插件开发教程指南">
<meta name="twitter:description" content="摘要：对于Xcode而言，我们苹果开发者并不陌生，对于Xcode的插件，我们也不陌生。但是，有几个人做过Xcode插件呢？！Who care？显然，博主是关心的，这里分享一下博主自己开发插件的过程。">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1492739-8badd5c1eaccb38b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-80507808-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo logo-text" href="/">Chars</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/atom.xml">Rss</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://charsdavy.github.io"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-xcode-plugin-develop" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Xcode插件开发教程指南
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/03/25/xcode-plugin-develop/" class="article-date">
  <time datetime="2016-03-25T13:58:50.000Z" itemprop="datePublished">2016-03-25</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>

<!--
      
-->
    </div>
    <div class="article-entry" itemprop="articleBody">
      <p>版权所有，请勿私自转载分享至其他平台！</p>
      
        <p>摘要：对于Xcode而言，我们苹果开发者并不陌生，对于Xcode的插件，我们也不陌生。但是，有几个人做过Xcode插件呢？！Who care？显然，博主是关心的，这里分享一下博主自己开发插件的过程。</p>
<a id="more"></a>
<p>在平时开发过程中我们使用了很多的Xcode插件，虽然官方对于插件制作没有提供任何支持，但是加载三方的插件，默认还是被允许的。第三方的插件，存放在 <code>~/Library/Application Support/Developer/Shared/Xcode/Plug-ins</code>文件夹中，后缀名必须是<code>.xcplugin</code> ，其实际上是一种bundle。所以我们创建一个插件工程，直接创建bundle工程即可。然后通过修改后缀名为<code>.xcplugin</code>，将其放到<code>~/Library/Application Support/Developer/Shared/Xcode/Plug-ins</code>目录中即可。</p>
<p>Xcode插件开发现在主要通过两种方式实现，其实也就是一种，只不过其中一种是使用别人提供的开发模板来省去很多中间步骤而已。文章会依次详细介绍两种的实现方法。</p>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="方式一：通过Bundle实现"><a href="#方式一：通过Bundle实现" class="headerlink" title="方式一：通过Bundle实现"></a>方式一：通过Bundle实现</h2><p>1.创建Bundle工程</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330144728207-192574452.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-8badd5c1eaccb38b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>2.工程设置</p>
<p>插件工程和普通的bundle工程还是有区别的,所以需要进行特殊的设置。</p>
<p>1）工程的plist文件</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330144905629-871612988.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-fd793ba30c7f7fca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>添加三项：</p>
<p>XCPluginHasUI = NO</p>
<p>XC4Compatible = YES</p>
<p>DVTPlugInCompatibilityUUIDs 这是一个数组。数组内容字符串，指示了该插件兼容的Xcode版本，只有对应版本的Xcode的UIID加入这个数组，插件才能被加载。</p>
<p>否则，即使将插件放入Xcode的插件文件夹，插件也不会被加载。获取当前版本的Xcode的UUID方式：</p>
<p>在terminal中输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults read /Applications/Xcode.app/Contents/Info DVTPlugInCompatibilityUUID</span><br></pre></td></tr></table></figure>
<p>terminal会返回一串字符串，这就是Xcode的DVTPlugInCompatibilityUUID。</p>
<p>2）Build Setting</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145158129-342161810.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-44a2d20adddc97ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145210144-303815379.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-2dd7603d97b0b42f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>Installation Build Products Location 设置为 ${HOME} [显示的时候,显示的是你的用户目录]，这个是products的根目录。</p>
<p>Installation Directory 设置为 /Library/Application Support/Developer/Shared/Xcode/Plug-ins，这个是指定你的插件安装的目录。</p>
<p> <strong>注意，这里填入的其实是相对目录。</strong></p>
<p>插件的绝对目录是这样的，例如 /Users/yohunl/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins/Alcatraz.xcplugin ，最后的绝对目录是 Installation Build Products Location和Installation Directory的结合，这也是为什么两者都要设置的原因。</p>
<p>Deployment Location 设置为 YES，这个是指示该工程不使用设置里的build location，而是用Installation Directory来确定build后放置的位置。</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145434019-1733725866.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-9c41ca195b3ba670.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>默认工程生成的相关文件位置都是 Build Locations指定的，通过Deployment Location 设置为 YES告诉工程，我们不使用这个默认的设置，而是我们自定义的。</p>
<p>Wrapper extension 设置为 xcplugin，后缀名必须为xcplugin，否则不会被加载。</p>
<h2 id="方式二：通过模板实现"><a href="#方式二：通过模板实现" class="headerlink" title="方式二：通过模板实现"></a>方式二：通过模板实现</h2><p>1）下载Xcode插件开发模板</p>
<p>地址：<a href="https://github.com/kattrali/Xcode-Plugin-Template">https://github.com/kattrali/Xcode-Plugin-Template</a></p>
<p>2）将下载下来的template复制到 ~/Library/Developer/Xcode/Templates/Project Templates/Application Plug-in/Xcode Plugin.xctemplate文件夹中，如果没有对应的文件夹就自己手动创建一个。</p>
<p>3）重启Xcode，当你新建一个工程的时候就可以在OS X中看到一个Application Plug-in的选项，里面有一个Xcode Plug-in模板。</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330150045894-1159966575.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-12e203138789f666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>通过以上的两种准备方式，我们已可以创建Xcode插件工程，接下来就是如何实现插件功能。</p>
<p>1.功能需求<br>在当前选中文件中实现代码风格重构，目前主要实现setter方法这一风格重构。例如，</p>
<p><code>[self setName:@&quot;Davy&quot;];</code> ==&gt; <code>self.name = @&quot;Davy&quot;;</code></p>
<p>2.思路分析</p>
<p>1）找到当前文件中符合setter方法命名风格的方法调用。</p>
<p>2）替换找到的符合重构风格的代码，提醒用户保存。</p>
<p>3.技术难点</p>
<p>1）Xcode代码编辑框文件内容操作。</p>
<p>2）正则表达式书写。</p>
<p>3）Xcode代码编辑框提醒用户保存文件。</p>
<p>关于最后一点，因为Xcode对于没有保存的已修改过的文件会显灰以提示用户该文件需要保存，我们可以借鉴这种方式。另外，在查找时，如果能够实现高亮并且跟随滚动，效果会更佳。</p>
<p>4.关键代码</p>
<p>以上这些问题，本人在“Refactor Code”插件中全部实现，现在放上关键方法。</p>
<p>1）添加菜单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-(void) setupMenuItem &#123;</span><br><span class="line">    // Menu Item:</span><br><span class="line">    NSMenuItem *editMenuItem = [[NSApp mainMenu] itemWithTitle:@&quot;Edit&quot;];</span><br><span class="line">    if (editMenuItem) &#123;</span><br><span class="line">        [[editMenuItem submenu] addItem:[NSMenuItem separatorItem]];</span><br><span class="line">        NSMenu *refactorCodeMenu = [[NSMenu alloc] initWithTitle:@&quot;Refactor Code&quot;];</span><br><span class="line">        NSMenuItem *menuItem;</span><br><span class="line">        menuItem = [[NSMenuItem alloc] initWithTitle:@&quot;Refactor Method Style&quot; action:@selector(refactorMethodStyleMenuAction) keyEquivalent:@&quot;&quot;];</span><br><span class="line">        [menuItem setTarget:self]; [refactorCodeMenu addItem:menuItem];</span><br><span class="line">        NSMenuItem *refactorCodeMenuItem = [[NSMenuItem alloc] initWithTitle:@&quot;Refactor Code&quot; action:nil keyEquivalent:@&quot;&quot;];</span><br><span class="line">        [refactorCodeMenuItem setSubmenu:refactorCodeMenu];</span><br><span class="line">        [[editMenuItem submenu] addItem:refactorCodeMenuItem];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401135707035-2105407027.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-255646a7f96b5d6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>2）显示操作面板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (void)refactorMethodStyleMenuAction &#123;</span><br><span class="line">    [self.operateController showWindow:nil];</span><br><span class="line">    NSURL *url = [[NSBundle bundleForClass:[self class]] URLForResource:@&quot;DZOperateController&quot; withExtension:@&quot;nib&quot;];</span><br><span class="line">    if (!url) &#123;</span><br><span class="line">        NSAlert *alert = [[NSAlert alloc] init];</span><br><span class="line">        alert.messageText = @&quot;Refactor Method Style could not be shown because the plugin is corrupted.&quot;;</span><br><span class="line">        alert.informativeText = @&quot;If you build the plugin from sources using Xcode, make sure to perform “Clean Build Folder“ in　　　　　　　　Xcode and then build the plugin again.\n\nIf you installed the plugin via Alctraz, there is a pending issue causing　　　　　　　　some files to be missing in the plugin. Prefer to install it via the plugin webpage.&quot;;</span><br><span class="line">        [alert addButtonWithTitle:@&quot;Download Latest&quot;];</span><br><span class="line">        [alert addButtonWithTitle:@&quot;Cancel&quot;];</span><br><span class="line">        NSModalResponse result = [alert runModal];</span><br><span class="line">        if (result == NSAlertFirstButtonReturn) &#123;</span><br><span class="line">            [[NSWorkspace sharedWorkspace] openURL:[NSURL URLWithString:@&quot;https://github.com/CharsDavy/RefactorCodePlugin-Xcode&quot;]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401135950379-1172628646.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-f71208a60c0568c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>3）查找替换代码风格</p>
<p>这一部分是重点部分，包括如何书写正则表达式，并且利用正则表达式生成替换字符。还包括高亮代码，具体可以参见本人源码：<a href="https://github.com/CharsDavy/RefactorCodePlugin-Xcode">https://github.com/CharsDavy/RefactorCodePlugin-Xcode</a></p>
<p>4）最终效果图</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401140322598-323202767.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-c5cd468f1b7f4332.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<h1 id="提交插件至Alcatraz"><a href="#提交插件至Alcatraz" class="headerlink" title="提交插件至Alcatraz"></a>提交插件至Alcatraz</h1><p>1.打开Alcatraz的插件包仓库，地址：<a href="https://github.com/supermarin/alcatraz-packages">https://github.com/supermarin/alcatraz-packages</a></p>
<p>2.在简介里可以看到Alcatraz的包分为三类，分别为：插件(plugins)，配色方案(color schemes)和模板(templates)。每个包都必须包含”name”、”url”和”description”字段，还有一个可选的”screenshot”字段。</p>
<p>3.Fork这个仓库，再克隆到本地。</p>
<p>4.以添加”Refactor Code”插件为例，打开packages.json文件，在”plugins”数组里加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  &quot;name&quot;: &quot;Refactor Code&quot;,</span><br><span class="line">  &quot;url&quot;: &quot;https://github.com/CharsDavy/RefactorCodePlugin-Xcode.git&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;Refactor code style,such as setter method.&quot;,</span><br><span class="line">  &quot;screenshot&quot;: &quot;https://github.com/CharsDavy/RefactorCodePlugin-Xcode/raw/master/Screenshots/window.png&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.提交代码到Fork的地址，再提交一个pull request到Master即可。</p>
<p>6.merged成功之后，即可看见以下效果图</p>
<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401092906176-1572332699.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-1a1146bc89c01d63.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>
<p>希望对大家有所帮助。</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/application/">application</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/10/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          Hello World in Hexo
        
      </div>
    </a>
  
  
    <a href="/2016/03/23/class-dump-using/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">聊聊 class-dump 使用&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>




<div class="share_addthis">
  <div class="sharing addthis_toolbox share">
    <a class="addthis_button_facebook_like"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-560c64c35486b3d4" async="async"></script>
</div>




<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      Copyright &copy; 2013 - 2017 Chars Davy&nbsp; in <a target="_blank" href="https://github.com/charsdavy">Github</a>. Powered by <a target="_blank" href="https://hexo.io/">Hexo</a>.
     </div>
  </div>
</footer>

    
<script>
  var disqus_shortname = 'charstechblog';
  
  var disqus_url = 'http://charsdavy.github.io/2016/03/25/xcode-plugin-develop/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<div id="totop" style="position:fixed;bottom:30px;right:30px;cursor: pointer;">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>
<script src="/js/totop.js"></script>

  </div>
</body>
</html>